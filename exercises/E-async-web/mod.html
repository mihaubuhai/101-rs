<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>E - Async and Rust for Web - Rust 101 - Exercises</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../0-install/mod.html"><strong aria-hidden="true">1.</strong> 0 - Installation</a></li><li class="chapter-item expanded "><a href="../A1-language-basics/mod.html"><strong aria-hidden="true">2.</strong> A1 - Language basics</a></li><li class="chapter-item expanded "><a href="../A2-advanced-intro/mod.html"><strong aria-hidden="true">3.</strong> A2 - Advanced Syntax, Ownership, references</a></li><li class="chapter-item expanded "><a href="../A3-traits-generics/mod.html"><strong aria-hidden="true">4.</strong> A3 - Traits and generics</a></li><li class="chapter-item expanded "><a href="../B-application-programming/mod.html"><strong aria-hidden="true">5.</strong> B - Application programming</a></li><li class="chapter-item expanded "><a href="../C-concurrency-parallelism/mod.html"><strong aria-hidden="true">6.</strong> C - Concurrency & Parallelism</a></li><li class="chapter-item expanded "><a href="../D-trait-objects-patterns/mod.html"><strong aria-hidden="true">7.</strong> D - Trait objects and Rust patterns</a></li><li class="chapter-item expanded "><a href="../E-async-web/mod.html" class="active"><strong aria-hidden="true">8.</strong> E - Async and Rust for Web</a></li><li class="chapter-item expanded "><a href="../F-safe-unsafe/mod.html"><strong aria-hidden="true">9.</strong> F - Safe Unsafe Rust</a></li><li class="chapter-item expanded "><a href="../G-ffi/mod.html"><strong aria-hidden="true">10.</strong> G - FFI and Dynamic modules</a></li><li class="chapter-item expanded "><a href="../P-final-project/mod.html"><strong aria-hidden="true">11.</strong> P Final project</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust 101 - Exercises</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="module-e---async-and-rust-for-web"><a class="header" href="#module-e---async-and-rust-for-web">Module E - Async and Rust for Web</a></h1>
<p><a href="/slides/E/">Slides</a> (or <a href="/slides/E-async-web.pdf">pdf</a>)</p>
<h2 id="e1-channels"><a class="header" href="#e1-channels">E.1 Channels</a></h2>
<p>Channels are a very useful way to communicate between threads and <code>async</code> tasks. They allow for decoupling your application into many tasks. You'll see how that can come in nicely in exercise E.2. In this exercise, you'll implement two variants: a oneshot channel and a multi-producer-single-consumer (MPSC) channel. If you're up for a challenge, you can write a broadcast channel as well.</p>
<h3 id="e1a-mpsc-channel-"><a class="header" href="#e1a-mpsc-channel-">E.1.A MPSC channel ⭐⭐</a></h3>
<p>A multi-producer-single-consumer (MPSC) channel is a channel that allows for multiple <code>Sender</code>s to send many messages to a single <code>Receiver</code>.</p>
<p>Open <code>exercises/E/1-channels</code> in your editor. You'll find the scaffolding code there. For part A, you'll work in <code>src/mpsc.rs</code>. Fix the <code>todo!</code>s in that file in order to make the test pass. To test, run:</p>
<pre><code class="language-bash">cargo test -- mpsc
</code></pre>
<p>If your tests are stuck, probably either your implementation does not use the <code>Waker</code> correctly, or it returns <code>Poll::Pending</code> where it shouldn't.</p>
<h3 id="e1b-oneshot-channel-"><a class="header" href="#e1b-oneshot-channel-">E.1.B Oneshot channel ⭐⭐⭐</a></h3>
<p>A oneshot is a channel that allows for one <code>Sender</code> to send exactly one message to a single <code>Receiver</code>.</p>
<p>For part B, you'll work in <code>src/broadcast.rs</code>. This time, you'll have to do more yourself. Intended behavior:</p>
<ul>
<li><code>Receiver</code> implements <code>Future</code>. It returns <code>Poll::Ready(Ok(T))</code> if <code>inner.data</code> is <code>Some(T)</code>, <code>Poll::Pending</code> if <code>inner.data</code> is <code>None</code>, and <code>Poll::Ready(Err(Error::SenderDropped))</code> if the <code>Sender</code> was dropped.</li>
<li><code>Receiver::poll</code> replaces <code>inner.waker</code> with the one from the <code>Context</code>.</li>
<li><code>Sender</code> consumes <code>self</code> on send, allowing the it to be used no more than once. Sending sets <code>inner.data</code> to <code>Some(T)</code>. It returns <code>Err(Error::ReceiverDropped(T))</code> if the <code>Receiver</code> was dropped before sending.</li>
<li><code>Sender::send</code> wakes <code>inner.waker</code> after putting the data in <code>inner.data</code></li>
<li>Once the <code>Sender</code> is dropped, it marks itself dropped with <code>inner</code></li>
<li>Once the <code>Receiver</code> is dropped, it marks itself dropped with <code>inner</code></li>
<li>Upon succesfully sending the message, the consumed <code>Sender</code> is not marked as dropped. Instead <code>std::mem::forget</code> is used to avoid running the destructor.</li>
</ul>
<p>To test, run:</p>
<pre><code class="language-bash">cargo test -- broadcast
</code></pre>
<h3 id="e1b-broadcast-channel-bonus-"><a class="header" href="#e1b-broadcast-channel-bonus-">E.1.B Broadcast channel (bonus) ⭐⭐⭐⭐</a></h3>
<p>A Broadcast channel is a channel that supports multiple senders and receivers. Each message that is sent by any of the senders, is received by every receiver. Therefore, the implemenentation has to hold on to messages until they have been sent to every receiver that has not yet been dropped. This furthermore implies that the message shoud be cloned upon broadcasting.</p>
<p>For this bonus exercise, we provide no scaffolding. Take your inspiration from the <code>mpsc</code> and <code>oneshot</code> modules, and implement a <code>broadcast</code> module yourself.</p>
<h2 id="e2-chat-app"><a class="header" href="#e2-chat-app">E.2 Chat app</a></h2>
<p>In this exercise, you'll write a simple chat server and client based on <a href="https://lib.rs/crates/tokio">Tokio</a>. Open <code>exercises/E/2-chat</code> in your editor. The project contains a <code>lib.rs</code> file, in which a type <code>Message</code> resides. This <code>Message</code> defines the data the chat server and clients use to communicate.</p>
<h3 id="e2a-server-"><a class="header" href="#e2a-server-">E.2.A Server ⭐⭐⭐</a></h3>
<p>The chat server, which resides in <code>src/bin/server.rs</code> listens for incoming TCP connections on port 8000, and spawns two tasks (futures):</p>
<ul>
<li><code>handle_incoming</code>: reads lines coming in from the TCP connection. It reads the username the client provides, and broadcasts incoming <code>Messages</code>, possibly after some modification.</li>
<li><code>handle_outgoing</code>: sends messages that were broadcasted by the <code>handle_incoming</code> tasks to the client over TCP.</li>
</ul>
<p>Both <code>handle_incoming</code> and <code>handle_outgoing</code> contain a number to <code>todo</code>s. Fix them.</p>
<p>To start the server, run</p>
<pre><code class="language-bash">cargo run --bin server
</code></pre>
<h3 id="e2b-client-"><a class="header" href="#e2b-client-">E.2.B Client ⭐⭐</a></h3>
<p>The chat client, residing in <code>src/bin/client.rs</code> contains some todo's as well. Fix them to allow for registration and sending <code>Message</code>s to the server.</p>
<p>To start the client, run</p>
<pre><code class="language-bash">cargo run --bin client
</code></pre>
<p>If everything works well, you should be able to run multiple clients and see messages sent from each client in every other.</p>
<h2 id="e3-pastebin-"><a class="header" href="#e3-pastebin-">E.3 Pastebin ⭐⭐⭐</a></h2>
<p>This exercise is about writing a simple <a href="https://en.wikipedia.org/wiki/Pastebin">pastebin</a> web server. Like the quizzer app, you will need to set up the project yourself. This webserver will be powered by <a href="https://lib.rs/crates/axum"><code>axum</code></a>.</p>
<ul>
<li>Data is kept in memory. Bonus if you use a database or <code>sqlite</code>, but first make the app function properly without.</li>
<li>Expose a route to which a POST request can be sent, that accepts some plain text, and stores it along with a freshly generated UUID. The UUID is sent in the response. You can use the <a href="https://docs.rs/uuid/latest/uuid/"><code>uuid</code> crate</a> to generate UUIDs.</li>
<li>Expose a route to which a GET request can be sent, that accepts a UUID and returns the plain text corresponding to the UUID, or a 404 error if it doesn't exist.</li>
<li>Expose a route to which a DELETE request can be sent, that accepts a UUID and deletes the plain text corresonding to that UUID.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../D-trait-objects-patterns/mod.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../F-safe-unsafe/mod.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../D-trait-objects-patterns/mod.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../F-safe-unsafe/mod.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
